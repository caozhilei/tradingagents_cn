# TDX（通达信）数据源配置指南

## 概述

TDX（通达信）是一个免费的实时A股行情数据接口，提供A股实时行情和历史K线数据，**完全免费且无需API Key**。

## 配置步骤

### 1. 添加TDX数据源

1. 打开配置页面：`http://localhost:3000/settings/config`
2. 点击"添加数据源"按钮
3. 选择数据源类型：**通达信 (TDX)**

### 2. 填写配置信息

#### 基本信息

- **数据源类型**: `tdx`（自动填充，不可修改）
- **数据源名称**: `tdx`（自动生成，不可修改）
- **显示名称**: `通达信`（可自定义）
- **数据提供商**: `通达信`（可选）

#### 连接配置

- **API端点**: **留空即可**（TDX不需要API端点）
  - 前端会显示提示："通达信无需填写API端点（留空即可）"
  - 系统会自动使用内置的服务器列表连接通达信服务器

- **API Key**: **留空**（TDX不需要API Key）
  - TDX是完全免费的数据源，无需注册和API Key

- **API Secret**: 不显示（TDX不需要）

#### 性能配置

- **超时时间**: `30` 秒（默认值）
- **速率限制**: `100` 请求/分钟（默认值）
- **优先级**: `10`（建议设置为最高优先级，作为默认数据源）

#### 市场分类

- 勾选 **`a_shares`**（A股市场）

#### 高级设置

- **启用状态**: ✅ 启用
- **描述**: `通达信实时行情接口，提供A股实时行情和历史K线数据，完全免费且无需API Key`

### 3. 保存配置

点击"创建"或"更新"按钮保存配置。

### 4. 测试连接

点击"测试连接"按钮验证配置是否正确：

- ✅ **成功**: 显示"成功连接到通达信数据源"，包含测试股票信息（如：000001 平安银行）
- ❌ **失败**: 显示具体错误信息（连接失败、库未安装等）

## 技术说明

### 服务器连接

TDX数据源使用TCP/IP直接连接到通达信服务器，系统内置了多个备用服务器：

- `115.238.56.198:7709`
- `115.238.90.165:7709`
- `180.153.18.170:7709`
- `119.147.212.81:7709`

系统会自动尝试连接这些服务器，直到成功连接。

### 配置文件

如果需要自定义服务器列表，可以在 `data/tdx_servers_config.json` 文件中配置：

```json
[
  {
    "ip": "115.238.56.198",
    "port": 7709
  },
  {
    "ip": "115.238.90.165",
    "port": 7709
  }
]
```

### 依赖库

TDX数据源需要安装 `pytdx` 库：

```bash
pip install pytdx
```

如果未安装，测试连接时会提示："通达信工具模块未安装，请确保 pytdx 库已安装: pip install pytdx"

## 常见问题

### Q: API端点字段应该填写什么？

**A**: TDX数据源**不需要填写API端点**，留空即可。前端会显示提示信息说明这一点。

### Q: 为什么测试连接失败？

**A**: 可能的原因：
1. **网络问题**: 无法连接到通达信服务器，请检查网络连接
2. **库未安装**: 确保已安装 `pytdx` 库：`pip install pytdx`
3. **服务器维护**: 通达信服务器可能暂时不可用，稍后重试

### Q: TDX数据源支持哪些市场？

**A**: TDX主要支持：
- ✅ A股市场（上海、深圳）
- ✅ 港股市场（部分功能）

### Q: TDX数据源是免费的吗？

**A**: 是的，TDX是完全免费的数据源，无需注册、无需API Key，可以直接使用。

### Q: 如何设置TDX为默认数据源？

**A**: 
1. 在数据源配置中，将TDX的优先级设置为最高（如：10）
2. 在系统设置中，将默认数据源设置为 `TDX`

## 相关文档

- [TDX API分析文档](../analysis/tdx_api_analysis.md)
- [TDX集成文档](../changes/tdx_as_default_datasource.md)
- [TDX测试功能修复](../changes/tdx_datasource_test_fix.md)

