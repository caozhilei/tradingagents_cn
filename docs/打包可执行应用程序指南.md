# TradingAgents-CN 可执行应用程序打包指南

## 📋 概述

本指南介绍如何将 TradingAgents-CN 项目打包成可执行应用程序，以便在其他电脑上安装和运行。

## 🎯 打包方式

项目支持两种打包方式：

### 1. 便携版（绿色版）
- **格式**: ZIP压缩包
- **特点**: 解压即用，无需安装
- **适用场景**: 快速部署、U盘运行、多版本共存

### 2. 安装程序版
- **格式**: Windows安装程序（.exe）
- **特点**: 图形化安装界面，自动配置
- **适用场景**: 正式部署、用户友好、系统集成

## 🚀 快速开始

### 一键打包（推荐）

```powershell
# 完整打包（前端 + 便携版 + 安装程序）
powershell -ExecutionPolicy Bypass -File scripts\build_executable.ps1
```

### 分步打包

```powershell
# 1. 只构建前端
powershell -ExecutionPolicy Bypass -File scripts\build_executable.ps1 -SkipPortable -SkipInstaller

# 2. 只创建便携版
powershell -ExecutionPolicy Bypass -File scripts\build_executable.ps1 -SkipFrontend -SkipInstaller

# 3. 只创建安装程序（需要先有便携版）
powershell -ExecutionPolicy Bypass -File scripts\build_executable.ps1 -SkipFrontend -SkipPortable
```

## 📦 打包参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `-Version` | 从VERSION文件读取 | 指定版本号 |
| `-SkipFrontend` | false | 跳过前端构建 |
| `-SkipPortable` | false | 跳过便携版打包 |
| `-SkipInstaller` | false | 跳过安装程序创建 |
| `-SkipEmbeddedPython` | false | 跳过嵌入式Python设置 |
| `-BackendPort` | 8000 | 后端默认端口 |
| `-MongoPort` | 27017 | MongoDB默认端口 |
| `-RedisPort` | 6379 | Redis默认端口 |
| `-NginxPort` | 80 | Nginx默认端口 |
| `-PythonVersion` | 3.10.11 | Python版本 |

## 🔧 前置要求

### 必需工具

1. **Python 3.10+**
   - 用于运行打包脚本和项目代码

2. **Node.js 18+ 和 Yarn**
   - 用于构建前端
   ```powershell
   # 检查Node.js版本
   node --version
   
   # 检查Yarn版本
   yarn --version
   ```

3. **PowerShell 5.1+**
   - Windows系统自带

### 可选工具（用于创建安装程序）

4. **NSIS (Nullsoft Scriptable Install System)**
   - 用于创建Windows安装程序
   - 下载地址: https://nsis.sourceforge.io/Download
   - 安装后会自动检测，无需配置

## 📁 输出文件

打包完成后，所有文件将输出到 `release/packages/` 目录：

```
release/packages/
├── TradingAgentsCN-Portable-v1.0.0-preview-20250113-120000.zip  # 便携版
└── TradingAgentsCNSetup-v1.0.0-preview.exe                      # 安装程序
```

### 文件大小参考

- **便携版ZIP**: ~300-500 MB（压缩后）
- **安装程序EXE**: ~300-500 MB（压缩后）
- **解压后大小**: ~1.3-1.5 GB

## 🎯 使用场景

### 场景1: 开发测试

```powershell
# 快速同步和构建，不打包
powershell -ExecutionPolicy Bypass -File scripts\deployment\sync_and_build_only.ps1
```

### 场景2: 内部测试

```powershell
# 创建便携版，方便测试
powershell -ExecutionPolicy Bypass -File scripts\build_executable.ps1 -SkipInstaller
```

### 场景3: 正式发布

```powershell
# 完整打包，包含安装程序
powershell -ExecutionPolicy Bypass -File scripts\build_executable.ps1
```

## 📝 打包流程详解

### 步骤1: 构建前端

1. 安装前端依赖 (`yarn install`)
2. 构建前端 (`yarn vite build`)
3. 输出到 `frontend/dist/`

### 步骤2: 同步代码

1. 同步项目代码到 `release/TradingAgentsCN-portable/`
2. 排除开发文件（`.git`, `tests`, `docs`等）
3. 复制配置文件

### 步骤3: 设置嵌入式Python（可选）

1. 下载嵌入式Python 3.10.11
2. 解压到 `vendors/python/`
3. 更新启动脚本使用嵌入式Python

### 步骤4: 创建便携版

1. 复制前端构建产物
2. 创建虚拟环境（venv）
3. 安装Python依赖
4. 打包MongoDB和Redis（便携版）
5. 创建启动脚本
6. 压缩为ZIP文件

### 步骤5: 创建安装程序（可选）

1. 读取便携版ZIP包
2. 编译NSIS安装脚本
3. 生成安装程序EXE

## 🔍 故障排除

### 问题1: 前端构建失败

**症状**: `yarn install` 或 `yarn vite build` 失败

**解决方案**:
```powershell
# 清理并重新安装
cd frontend
Remove-Item node_modules -Recurse -Force
Remove-Item yarn.lock
yarn install
yarn vite build
```

### 问题2: 找不到NSIS编译器

**症状**: 提示"未找到NSIS编译器"

**解决方案**:
1. 从 https://nsis.sourceforge.io/Download 下载并安装NSIS
2. 安装到默认路径: `C:\Program Files (x86)\NSIS\`
3. 重新运行打包脚本

### 问题3: 便携版打包失败

**症状**: 便携版打包过程中出错

**解决方案**:
```powershell
# 检查便携版目录
cd release\TradingAgentsCN-portable

# 手动测试启动
.\start_all.ps1
```

### 问题4: 安装程序无法运行

**症状**: 安装程序启动后立即退出

**解决方案**:
1. 检查便携版ZIP包是否存在
2. 检查NSIS脚本语法
3. 查看NSIS编译日志

## 📊 打包时间参考

| 步骤 | 时间 | 说明 |
|------|------|------|
| 前端构建 | 2-5分钟 | 取决于网络和CPU |
| 代码同步 | 30秒-1分钟 | 取决于文件数量 |
| 嵌入式Python | 1-2分钟 | 首次下载需要时间 |
| 便携版打包 | 5-10分钟 | 包括依赖安装 |
| 安装程序 | 1-2分钟 | NSIS编译 |
| **总计** | **10-20分钟** | 完整打包流程 |

## 🎁 分发建议

### 便携版分发

1. 上传ZIP包到网盘或文件服务器
2. 提供解压和运行说明
3. 建议用户解压到非系统盘（如 `D:\TradingAgentsCN\`）

### 安装程序分发

1. 上传EXE文件到下载服务器
2. 提供安装和使用说明
3. 建议用户以管理员权限运行安装程序

## 📚 相关文档

- [绿色版安装指南](https://mp.weixin.qq.com/s/eoo_HeIGxaQZVT76LBbRJQ)
- [Docker部署指南](https://mp.weixin.qq.com/s/JkA0cOu8xJnoY_3LC5oXNw)
- [本地安装指南](https://mp.weixin.qq.com/s/cqUGf-sAzcBV19gdI4sYfA)

## 💡 最佳实践

1. **版本管理**: 始终从 `VERSION` 文件读取版本号
2. **测试优先**: 打包前先测试便携版
3. **清理环境**: 打包前清理旧的构建产物
4. **文档同步**: 更新版本号时同步更新文档
5. **签名验证**: 正式发布前验证安装程序完整性

## 🆘 获取帮助

如果遇到问题，请：

1. 查看日志文件: `logs/`
2. 检查打包脚本输出
3. 参考故障排除章节
4. 提交Issue到项目仓库

---

**最后更新**: 2025-01-13
**版本**: v1.0.0-preview

